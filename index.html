<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>recipe</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./recipe.css?20190109" media="all">
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://github.com/pilsnerurquell/BDO_Recipe/blob/16cceff16d9f806127ef4e53a692819ee94eeb9c/cooking.json"></script>
    <script src="https://github.com/pilsnerurquell/BDO_Recipe/blob/16cceff16d9f806127ef4e53a692819ee94eeb9c/alchemy.json"></script>
    
    <style>
    ul, li {
      list-style-type: none;
    }
    .openable {
      cursor: pointer;
      position: relative;
      margin: 4px 0;
    }
    .openable::before {
      content: '＋';
      margin-right: 5px;
    }
    .openable.open::before {
      content: '－';
    }
    .recipe-title {
      font-weight: bold;
    }
    .control-buttons button {
      margin-right: 8px;
    }
  </style>
  </head>
  
  
  <body>
  
      <div id="main">
      
      
          <div id="info1">
              
                            
              <div id="erabu">
                    <label><input type="radio" value="all" checked>全て</label>
                    <label><input type="radio" value="見習い">見習</label>
                    <label><input type="radio" value="熟練">熟練</label>
                    <label><input type="radio" value="専門">専門</label><br>
                    <label><input type="radio" value="職人">職人</label>
                    <label><input type="radio" value="名匠">名匠</label>
                    <label><input type="radio" value="道人">道人</label>
              </div>
              
              
              <dl>
                    <dt class="midashi">互換素材</dt>
                    
                        <dl class="nakami">
                            <dt class="nakami_2">穀物類</dt>
                                <dd>ジャガイモ・大麦・小麦<br>トウモロコシ・サツマイモ・米</dd>
                            <dt class="nakami_2">野菜類</dt>
                                <dd>カボチャ・キャベツ・トマト<br>パプリカ・オリーブ・白菜</dd>
                            <dt class="nakami_2">魚類</dt>
                                <dd>川魚・海魚全般</dd>
                            <dt class="nakami_2">海産物</dt>
                                <dd>貝・イカ・カニ・クラゲ<br>コウイカ・タコ・タツノオトシゴ<br>ヒトデ・スッポン</dd>
                            <dt class="nakami_2">一般肉類</dt>
                                <dd>羊肉・豚肉・牛肉・イタチ肉<br>オオカミ肉・キツネ肉・クマ肉<br>サイの肉・シカ肉・タヌキ肉・ヤギ肉</dd>
                            <dt class="nakami_2">鳥肉</dt>
                                <dd>鶏肉・フラミンゴ肉・クークー鳥肉</dd>
                            <dt class="nakami_2">爬虫類肉</dt>
                                <dd>リザード肉・ワラゴンの肉<br>チータードラゴン肉・ワーム肉</dd>
                            <dt class="nakami_2">ワニ肉</dt>
                                <dd>ワニの肉・ぶよぶよしたクジラの肉</dd>
                            <dt class="nakami_2">マーモット肉</dt>
                                <dd>マーモット肉・ヤクの肉</dd>
                            <dt class="nakami_2">フルーツ類</dt>
                                <dd>リンゴ・ブドウ・イチゴ<br>サクランボ・ナシ・バナナ<br>パイナップル・山いちご・柿</dd>
                            <dt class="nakami_2">花類</dt>
                                <dd>チューリップ・ヒマワリ・バラ</dd>
                            <dt class="nakami_2">油類</dt>
                                <dd>オリーブオイル・コーン油・綿実油</dd>
                            <dt class="nakami_2">草</dt>
                                <dd>野生野草＝雑草4～5　試薬のみ1</dd>
                                <dd>野生薬草の束or山各種＝ノーマル3個分</dd>
                                <dd>高級薬草＝ノーマル3個分</dd>
                                <dd>特級薬草＝ノーマル7個分</dd>
                            <dt class="nakami_2">血</dt>
                                <dd>[クマ＝ライオン＝トロル＝オーガ＝ヤク］</dd>
                                <dd>[キツネ＝サソリ＝イタチ＝タヌキ]</dd>
                                <dd>[オオカミ＝サイ＝フラミンゴ＝ﾁｰﾀｰﾄﾞﾗｺﾞﾝ]</dd>
                                <dd>[豚＝鹿＝羊＝牛＝ワラゴン＝ラマ＝ヤギ]</dd>
                                <dd>[リザード＝ワーム＝コウモリ＝クークー鳥］</dd>
                            <dt class="nakami_2">その他</dt>
                                <dd>精製水＝蒸留水</dd>
                                <dd>HPポーション(中)＝HPポーション(小)</dd>
                                <dd>MPポーション(中)＝MPポーション(小)</dd>
                                <dd>HPポーション(大)＝HPポーション(小)3</dd>
                                <dd>MPポーション(大)＝MPポーション(小)3</dd>
                                <dd>溶けた鉄の欠片＝鉄鉱石9～10</dd>
                                <dd>大きなキノコ各種＝ノーマル3</dd>
                                <dd>高級＝ノーマル2</dd>
                                <dd>特級＝ノーマル4</dd>
                                <dd>リンゴ＝フルーツ類</dd>
                        </dl>
                        
                    <dt class="midashi">加工素材</dt>
                        <dl class="nakami">
                            <dt class="nakami_2">穀物粉類</dt>
                                <dd>穀物類を粉砕</dd>
                            <dt class="nakami_2">穀物生地類</dt>
                                <dd>穀物粉類と料理用ミネラルウォーターを混合</dd>
                            <dt class="nakami_2">クリーム</dt>
                                <dd>牛乳と砂糖を混合</dd>
                            <dt class="nakami_2">バター</dt>
                                <dd>クリームと塩を混合</dd>
                            <dt class="nakami_2">チーズ</dt>
                                <dd>牛乳を乾燥</dd>
                            <dt class="nakami_2">食用蜂蜜</dt>
                                <dd>野生のハチの巣を粉砕</dd>
                            <dt class="nakami_2">塩</dt>
                                <dd>海の水で満たしたビンを加熱</dd>
                            <dt class="nakami_2">みじん切りにした鳥肉</dt>
                                <dd>鳥肉・鶏肉を粉砕</dd>
                        </dl>
              </dl>
              
              
          </div>
          
          
          <div id="info2">
              
              
              <span id="cook">料理</span>
                        <ul class="cook_na1">
                        </ul>
                    
              <span id="alc">錬金</span>
                    
                        <ul id="alc_na1">                        
                        </ul>
              
              
              
          </div>
      
      
      </div>
      
      
      <script>
          let cookingRecipe, alchemyRecipe;
          
          
          $(function(){
              //アコーディオン動作
              $('.midashi,.nakami_2,#cook,#alc').click(function(event){
                $(this).next().slideToggle();
                $(this).toggleClass("open");
              });
              
          });

          function renderRecipeTree(recipe, allRecipes, multiplier = 1) {
            const $li = $(`<li class="openable">${recipe.レシピ}（×${multiplier}）</li>`);
            const $detail = $('<ul style="display: none;"></ul>');
            for (let i = 1; i <= 5; i++) {
              const material = recipe[`素材${i}`];
              const qty = recipe[`分量${i}`];
              if (material && qty) {
                const match = allRecipes.find(r => r.レシピ === material);
                const scaledQty = qty * multiplier;
                if (match) {
                  $detail.append(renderRecipeTree(match, allRecipes, scaledQty));
                } else {
                  $detail.append(`<li>${material} × ${scaledQty}</li>`);
                }
              }
            }
            $li.append($detail);
            return $li;
          }
          
          
          function renderCookingList(data, $container) {
            $container.empty();
            const grouped = data.reduce((acc, item) => {
              if (!acc[item.五十音]) acc[item.五十音] = [];
              acc[item.五十音].push(item);
              return acc;
            }, {});
            for (const [group, recipes] of Object.entries(grouped)) {
              const $groupLi = $(`<li class="openable"><strong>${group}</strong></li>`);
              const $subList = $('<ul style="display:none;"></ul>');
              for (const recipe of recipes) {
                $subList.append(renderRecipeTree(recipe, data));
              }
              $groupLi.append($subList);
              $container.append($groupLi);
            }
          }


          function renderAlchemyList(data, $container) {
            $container.empty();
            const grouped = data.reduce((acc, item) => {
              if (!acc[item.分類]) acc[item.分類] = [];
              acc[item.分類].push(item);
              return acc;
            }, {});
            for (const [group, recipes] of Object.entries(grouped)) {
              const $groupLi = $(`<li class="openable"><strong>${group}</strong></li>`);
              const $subList = $('<ul style="display:none;"></ul>');
              for (const recipe of recipes) {
                const $recipeLi = $(`<li class="recipe-title openable">${recipe.レシピ}</li>`);
                const $detail = $('<ul style="display:none;"></ul>');
                $recipeLi.on("click", function (e) {
                  e.stopPropagation();
                  if ($detail.children().length === 0) {
                    for (let i = 1; i <= 5; i++) {
                      const material = recipe[`素材${i}`];
                      const qty = recipe[`分量${i}`];
                      if (material && qty) {
                       const match = data.find(r => r.レシピ === material);
                        if (match) {
                        $detail.append(renderRecipeTree(match, data, qty));
                        } else {
                        $detail.append(`<li>${material} × ${qty}</li>`);
                        }
                      }
                    }
                  }
                  $detail.slideToggle();
                  $recipeLi.toggleClass("open");
                });
                $recipeLi.append($detail);
                $subList.append($recipeLi);
              }
              $groupLi.append($subList);
              $container.append($groupLi);
            }
          }


          function filterByDeliveryType(data, value) {
            return value === "all" ? data : data.filter(item => item.納品種別 === value);
          }



          // 初期読み込みとフィルター連動
          $(function() {
            $.getJSON("cooking.json", function(cookData) {
              cookingRecipe = cookData;
              // const val = $('#erabu input[name="sort"]:checked').val();
              // const filtered = filterByDeliveryType(cookData, val);
              renderCookingList(cookData, $(".cook_na1"));
            });

            $.getJSON("alchemy.json", function(alcData) {
              alchemyRecipe = alcData;
              // const val = $('#erabu input[name="sort"]:checked').val();
              // const filtered = filterByDeliveryType(alcData, val);
              renderAlchemyList(alcData, $("#alc_na1"));
            });

            $('#erabu input[name="sort"]').on('change', function() {
              const val = $(this).val();
              renderCookingList(filterByDeliveryType(cookingRecipe, val), $(".cook_na1"));
              renderAlchemyList(filterByDeliveryType(alchemyRecipe, val), $("#alc_na1"));
            });
          });
      </script>
      
      
  </body>
  
</html>